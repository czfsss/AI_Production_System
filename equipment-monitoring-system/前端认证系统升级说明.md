# 前端认证系统升级说明

## 概述

前端已经完成了与后端JWT认证系统的完整对接，现在具备了以下功能：

## ✅ 新增功能

### 1. 独立登录页面

- **路径**: `/login`
- **特性**:
  - 美观的双栏设计，左侧展示系统功能，右侧为登录表单
  - 支持登录/注册切换
  - 保持原有弹窗样式的忘记密码功能
  - 响应式设计，移动端友好

### 2. JWT令牌管理

- 自动存储和管理access_token和refresh_token
- 自动在请求头中添加Authorization
- 令牌过期自动刷新
- 刷新失败自动跳转登录页

### 3. 路由守卫

- 未登录用户自动跳转到登录页
- 已登录用户访问登录页自动跳转到主页
- 保护所有业务页面

### 4. HTTP客户端工具

- 自动处理认证头
- 自动令牌刷新机制
- 请求队列管理，避免并发刷新

## 🔄 变更说明

### 原有功能保持不变

- ✅ 弹窗登录的样式完全保持原样
- ✅ 用户信息显示区域样式不变
- ✅ 所有业务功能正常运行

### 新增变更

- 🆕 点击"登录"按钮现在跳转到独立登录页面
- 🆕 系统启动时检查登录状态，未登录自动跳转登录页
- 🆕 登录成功后返回JWT令牌而非直接的用户信息

## 📱 使用方法

### 1. 访问系统

```
http://localhost:1133
```

- 首次访问自动跳转到登录页面
- 登录成功后跳转到监控页面

### 2. 新用户注册

- 在登录页面点击"立即注册"
- 填写昵称、7位数字工号、密码
- 注册成功自动登录并跳转

### 3. 开发者使用HTTP客户端

#### 方式1：使用新的HTTP客户端（推荐）

```typescript
import { api } from '@/utils/httpClient'

// 自动处理认证头和令牌刷新
const response = await api.get('/api/user/profile')
const userData = await response.json()
```

#### 方式2：手动管理（兼容旧代码）

```typescript
import { useAuthStore } from '@/stores/auth'

const authStore = useAuthStore()
const authHeader = authStore.getAuthHeader()

if (authHeader) {
  const response = await fetch('/api/some-protected-endpoint', {
    headers: {
      Authorization: authHeader,
    },
  })
}
```

## 🔧 技术实现

### 1. 路由结构

```
/login          - 登录页面（未登录用户）
/monitoring     - 设备监控（需要认证）
/maintenance    - 辅助维修（需要认证）
/knowledge      - 智能问答（需要认证）
```

### 2. 认证流程

```
1. 用户访问系统
2. 路由守卫检查登录状态
3. 未登录 → 跳转登录页
4. 登录成功 → 获取JWT令牌
5. 存储令牌到localStorage
6. 跳转到业务页面
7. 后续请求自动携带令牌
8. 令牌过期自动刷新
```

### 3. 令牌刷新机制

```
1. API请求返回401
2. 检查是否有refresh_token
3. 调用刷新接口获取新令牌
4. 更新存储的令牌
5. 重试原请求
6. 刷新失败则清除认证信息并跳转登录页
```

## 🎨 UI展示

### 登录页面特性

- **左侧**: 系统介绍和功能展示
  - 系统logo和标题
  - 三大核心功能卡片展示
  - 系统统计数据
- **右侧**: 登录/注册表单
  - 简洁的表单设计
  - 密码显示/隐藏切换
  - 登录/注册模式切换
  - 忘记密码功能（保持原有弹窗样式）

### 响应式设计

- 桌面端：双栏布局
- 平板端：适配屏幕尺寸
- 移动端：垂直堆叠布局

## 🚀 部署和测试

### 1. 启动前端

```bash
cd equipment-monitoring-system
npm run dev
```

### 2. 启动后端

```bash
cd fastapi-backend
python app/main.py
```

### 3. 测试流程

1. 访问 `http://localhost:1133`
2. 应该自动跳转到登录页面
3. 注册新用户或使用现有用户登录
4. 登录成功后应该跳转到监控页面
5. 在浏览器开发者工具中查看localStorage，应该能看到令牌
6. 刷新页面，应该保持登录状态

## 🔍 故障排除

### 1. 登录失败

- 检查后端是否正常运行
- 确认用户名密码是否正确
- 查看浏览器控制台错误信息

### 2. 令牌问题

- 清除浏览器localStorage重新登录
- 检查后端JWT配置
- 确认SECRET_KEY是否正确设置

### 3. 路由问题

- 确认路由守卫正常工作
- 检查Vue Router配置
- 查看浏览器Network面板

## 📋 升级清单

✅ 创建独立登录页面  
✅ 实现JWT令牌管理  
✅ 添加路由守卫  
✅ 创建HTTP客户端工具  
✅ 更新认证存储  
✅ 保持原有样式不变  
✅ 添加自动令牌刷新  
✅ 响应式设计适配

## 🎯 下一步优化建议

1. **安全增强**
   - 添加CSRF保护
   - 实现令牌黑名单
   - 添加设备指纹识别

2. **用户体验**
   - 添加"记住我"功能
   - 实现SSO单点登录
   - 添加登录历史记录

3. **监控告警**
   - 登录失败次数监控
   - 异常登录行为检测
   - 性能监控集成

---

**升级完成！** 您的前端现在已经完美集成了JWT认证系统。
