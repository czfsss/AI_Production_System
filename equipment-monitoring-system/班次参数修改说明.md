# 班次参数修改说明

## 问题描述
之前代码中对于classShift的传入逻辑有误，一直默认是早班。设备监控界面的WebSocket连接会返回两个参数：status和classlabel，其中classlabel表示当前班次（1代表早班，2代表中班，3代表晚班）。需要将这个值作为真实的班次作为请求参数传入。

## 解决方案

### 1. 修改useRealTimeMonitoring.ts
在handleWebSocketMessage函数中添加对classlabel参数的处理：
```javascript
// 从WebSocket消息中获取设备状态和班次信息
const status = data.status || '未知状态'
const classLabel = data.classlabel || data.class_label || 1 // 默认为1（早班）

// 将班次信息存储到localStorage和monitoringStore中
localStorage.setItem('currentClassLabel', classLabel.toString())
monitoringStore.setCurrentClassLabel(classLabel)
```

### 2. 修改monitoringStore
在monitoringStore中添加currentClassLabel状态和setCurrentClassLabel方法：
```javascript
const currentClassLabel = ref<number>(1) // 当前班次标签，1=早班，2=中班，3=晚班

// 设置当前班次标签
const setCurrentClassLabel = (classLabel: number) => {
  currentClassLabel.value = classLabel
}
```

### 3. 修改MonitoringView.vue
修改getClassShiftByShift函数，优先使用从设备监控WebSocket获取的班次信息：
```javascript
// 将班次代码转换为班次名称
const getClassShiftByShift = (shiftCode: string): string => {
  // 优先使用从设备监控WebSocket获取的班次信息
  const storedClassLabel = localStorage.getItem('currentClassLabel')
  if (storedClassLabel) {
    const classLabel = parseInt(storedClassLabel)
    switch (classLabel) {
      case 1:
        return '早班'
      case 2:
        return '中班'
      case 3:
        return '晚班'
      default:
        return '早班' // 默认返回早班
    }
  }
  
  // 如果没有从WebSocket获取的班次信息，则使用原始逻辑
  switch (shiftCode) {
    case 'A':
      return '早班'
    case 'B':
      return '中班'
    case 'C':
      return '晚班'
    default:
      return '早班' // 默认返回早班
  }
}
```

### 4. 修改useCharts.ts
修改connectWebSocket函数，优先使用从设备监控WebSocket获取的班次信息：
```javascript
// 连接WebSocket
const connectWebSocket = async (equipmentName: string, classShift: string) => {
  try {
    // 优先使用从设备监控WebSocket获取的班次信息
    const storedClassLabel = localStorage.getItem('currentClassLabel')
    let finalClassShift = classShift
    
    if (storedClassLabel) {
      const classLabel = parseInt(storedClassLabel)
      switch (classLabel) {
        case 1:
          finalClassShift = '早班'
          break
        case 2:
          finalClassShift = '中班'
          break
        case 3:
          finalClassShift = '晚班'
          break
        default:
          finalClassShift = '早班' // 默认值
      }
      console.log(`[ECharts] 使用从设备监控WebSocket获取的班次信息: ${finalClassShift} (classLabel: ${classLabel})`)
    }
    
    // 如果已经连接到相同的设备和班次，先断开连接
    if (isWebSocketConnected.value && currentEquipmentName.value === equipmentName && currentClassShift.value === finalClassShift) {
      disconnectWebSocket()
    }
    
    await echartsWebSocketService.connect(equipmentName, finalClassShift)
    console.log('[ECharts] WebSocket连接请求已发送')
  } catch (error) {
    console.error('[ECharts] WebSocket连接失败:', error)
    ElMessage.error('图表数据连接失败')
  }
}
```

## 效果说明
通过以上修改，系统现在能够：
1. 正确接收并存储设备监控WebSocket返回的classlabel参数
2. 将classlabel参数转换为对应的班次名称（1->早班，2->中班，3->晚班）
3. 在ECharts WebSocket连接时使用真实的班次信息作为请求参数
4. 确保界面显示的班次信息与真实的班次保持一致

这样就解决了之前classShift参数传入逻辑有误，一直默认是早班的问题。