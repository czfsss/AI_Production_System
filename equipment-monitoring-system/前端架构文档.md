# 智能设备监控与维修辅助系统 - 前端架构文档

## 📖 项目概述

本项目是一个基于现代前端技术栈构建的智能设备监控与维修辅助系统，专为工业设备实时监控、故障诊断和智能维修辅助而设计。

### 🎯 核心功能模块
- **设备监控**: 实时监控设备状态、参数展示、故障检测
- **辅助维修**: 智能故障分析、AI问答、备件查询
- **智能问答**: 工艺问答、制度问答、安全问答

## 🛠 技术栈

### 核心技术
- **Vue 3.5.18** - 响应式前端框架，使用 Composition API
- **TypeScript** - 静态类型检查，提高代码质量
- **Vite 7.0.6** - 现代构建工具，快速开发和打包
- **Pinia 3.0.3** - Vue 3 推荐的状态管理库

### UI 框架
- **Element Plus 2.10.5** - 企业级 Vue 组件库
- **Element Plus Icons** - 图标组件库

### 图表可视化
- **ECharts 6.0.0** - 强大的数据可视化图表库
- **@types/echarts** - ECharts TypeScript 类型定义

### 网络通信
- **Axios 1.11.0** - HTTP 客户端，用于API请求
- **WebSocket** - 原生WebSocket，用于实时数据通信

### 路由管理
- **Vue Router 4.5.1** - Vue官方路由管理器

### 内容渲染
- **Markdown-it 14.1.0** - Markdown解析和渲染
- **Highlight.js 11.11.1** - 代码语法高亮

### 开发工具
- **ESLint** - 代码质量检查
- **Prettier** - 代码格式化
- **Vitest** - 单元测试框架
- **Playwright** - 端到端测试框架

## 🏗 项目结构详解

```
equipment-monitoring-system/
├── public/                              # 静态资源目录
│   └── favicon.ico                     # 网站图标
├── src/                                # 源代码目录
│   ├── __tests__/                      # 测试文件目录
│   │   └── App.spec.ts                # 应用组件测试
│   ├── assets/                         # 静态资源
│   │   └── main.css                   # 全局样式文件
│   ├── components/                     # 可复用组件
│   │   ├── GlobalFaultAlert.vue       # 全局故障警告组件
│   │   ├── LoginButton.vue            # 登录按钮组件
│   │   └── MarkdownRenderer.vue       # Markdown渲染组件
│   ├── composables/                    # 组合式函数 (Vue 3 Composition API)
│   │   ├── useAuth.ts                 # 认证相关逻辑
│   │   ├── useCharts.ts               # 图表相关逻辑
│   │   ├── useDeviceBinding.ts        # 设备绑定逻辑
│   │   ├── useFaultAnalysis.ts        # 故障分析逻辑
│   │   ├── useFaultRecords.ts         # 故障记录逻辑
│   │   ├── useRealTimeMonitoring.ts   # 实时监控逻辑
│   │   └── useShiftAnalysis.ts        # 班次分析逻辑
│   ├── config/                         # 配置文件
│   │   └── api.ts                     # API配置和URL管理
│   ├── data/                          # 静态数据
│   │   ├── faultNames.ts              # 故障名称映射
│   │   └── README.md                  # 数据说明文档
│   ├── router/                         # 路由配置
│   │   └── index.ts                   # 路由定义和配置
│   ├── services/                       # 服务层
│   │   ├── difyAnalysis.ts            # AI分析服务
│   │   ├── echartsHttp.ts             # ECharts HTTP 数据服务
│   │   ├── echartsWebSocket.ts        # ECharts WebSocket 数据服务
│   │   ├── equipmentMonitor.ts        # 设备监控服务
│   │   ├── fault.ts                   # 故障相关服务
│   │   └── websocket.ts               # WebSocket 连接服务
│   ├── stores/                         # 状态管理 (Pinia)
│   │   ├── auth.ts                    # 认证状态管理
│   │   ├── counter.ts                 # 计数器状态(示例)
│   │   └── monitoring.ts              # 监控状态管理
│   ├── views/                          # 页面视图组件
│   │   ├── KnowledgeView.vue          # 智能问答页面
│   │   ├── MaintenanceView.vue        # 辅助维修页面
│   │   └── MonitoringView.vue         # 设备监控页面
│   ├── App.vue                        # 根组件
│   ├── main.ts                        # 应用入口文件
│   └── env.d.ts                       # TypeScript 环境声明
├── e2e/                               # 端到端测试
├── 班次参数修改说明.md                 # 班次参数文档
├── package.json                       # 项目依赖和脚本
├── vite.config.ts                     # Vite 构建配置
├── tsconfig.json                      # TypeScript 配置
├── eslint.config.ts                   # ESLint 配置
├── playwright.config.ts               # Playwright 测试配置
├── vitest.config.ts                   # Vitest 测试配置
└── index.html                         # HTML 入口文件
```

## 🧩 核心架构设计

### 1. 组件架构

#### 📱 视图层 (Views)
- **MonitoringView.vue**: 设备监控主页面，集成了设备绑定、实时监控、图表展示、故障分析等功能
- **MaintenanceView.vue**: 辅助维修页面，提供智能故障问答和备件查询功能
- **KnowledgeView.vue**: 智能问答页面，支持工艺、制度、安全三个问答智能体

#### 🔧 组件层 (Components)
- **GlobalFaultAlert.vue**: 全局故障警告组件，处理跨页面的故障提醒
- **LoginButton.vue**: 登录功能组件，集成用户认证逻辑
- **MarkdownRenderer.vue**: Markdown内容渲染组件，支持语法高亮

### 2. 状态管理架构 (Pinia)

#### 🔐 认证状态 (auth.ts)
```typescript
interface UserInfo {
  username: string
  nickname: string
}

// 核心功能
- isLoggedIn: 登录状态
- userInfo: 用户信息
- login(): 登录方法
- logout(): 登出方法
- localStorage 持久化存储
```

#### 📊 监控状态 (monitoring.ts)
```typescript
// 核心状态
- isMonitoring: 监控状态
- isDeviceBound: 设备绑定状态
- deviceStatus: 设备运行状态 ('running' | 'stopped' | 'fault')
- faultName: 故障名称
- equipmentName: 设备名称
- boundDeviceInfo: 绑定的设备信息
- monitoringStats: 监控统计数据
- activeFaultAlerts: 活跃故障警告列表
```

### 3. 组合式函数架构 (Composables)

采用 Vue 3 Composition API 设计模式，将业务逻辑抽象为可复用的组合式函数：

#### 🔑 useAuth.ts - 认证管理
```typescript
- showLoginPrompt: 登录提示状态
- requireAuth(): 需要认证时的处理逻辑
- openLoginDialog(): 打开登录对话框
```

#### 🔗 useDeviceBinding.ts - 设备绑定
```typescript
- 设备选择和绑定逻辑
- 设备参数管理
- 设备状态实时监控
- 故障检测和处理
```

#### 📈 useCharts.ts - 图表管理
```typescript
- ECharts 图表初始化和配置
- WebSocket 实时数据连接
- HTTP 轮询数据获取
- 图表自动刷新和响应式更新
```

#### 🚨 useFaultAnalysis.ts - 故障分析
```typescript
- AI 故障分析调用
- 流式分析结果处理
- 分析进度管理
```

### 4. 服务层架构 (Services)

#### 🌐 WebSocket 服务 (websocket.ts)
```typescript
class WebSocketService {
  - 连接管理和自动重连
  - 事件监听器模式
  - 错误处理和状态管理
}
```

#### 📡 HTTP 服务
- **equipmentMonitor.ts**: 设备状态查询
- **echartsHttp.ts**: 图表数据HTTP获取
- **fault.ts**: 故障相关API调用
- **difyAnalysis.ts**: AI分析服务集成

### 5. 路由架构 (Router)

采用路由懒加载策略，提高应用性能：
```typescript
routes: [
  { path: '/', redirect: '/monitoring' },
  { path: '/monitoring', component: () => import('../views/MonitoringView.vue') },
  { path: '/maintenance', component: () => import('../views/MaintenanceView.vue') },
  { path: '/knowledge', component: () => import('../views/KnowledgeView.vue') }
]
```

## 🔄 数据流架构

### 1. 实时数据流
```
WebSocket Server → WebSocketService → Composables → Pinia Store → Vue Components
```

### 2. HTTP 数据流
```
HTTP API → Axios → Service Layer → Composables → Pinia Store → Vue Components
```

### 3. 用户交互流
```
User Interaction → Vue Components → Composables → Pinia Store → Service Layer → API
```

## 🎨 UI/UX 设计架构

### 响应式设计
- 采用 Element Plus 响应式栅格系统
- 支持桌面端、平板、移动端适配
- 汉堡菜单设计，优化移动端体验

### 主题设计
- 渐变蓝色主题色彩方案
- 现代化卡片式布局
- 一致的阴影和圆角设计语言

### 交互设计
- 实时状态反馈
- 加载状态指示
- 错误提示和成功反馈
- 响应式动画效果

## 🔧 构建和开发架构

### Vite 配置特性
- **模块热替换 (HMR)**: 开发时快速更新
- **代码分割**: 按需加载，优化性能
- **TypeScript 支持**: 完整的类型检查
- **环境变量管理**: 支持开发、生产环境配置

### 代码分割策略
```typescript
// vite.config.ts 中的配置
manualChunks: {
  vendor: ['vue', 'vue-router', 'pinia'],
  elementPlus: ['element-plus'],
  charts: ['echarts']
}
```

## 🚀 性能优化架构

### 1. 懒加载策略
- 路由组件懒加载
- 图表按需加载
- 第三方库代码分割

### 2. 缓存策略
- localStorage 用户状态持久化
- HTTP 响应缓存
- 图表数据缓存

### 3. 实时通信优化
- WebSocket 连接复用
- 自动重连机制
- 消息队列管理

## 🔐 安全架构

### 认证机制
- 基于 Token 的身份验证
- localStorage 安全存储
- 路由守卫保护

### 数据安全
- API 请求参数验证
- XSS 防护
- CSRF 防护

## 📱 移动端适配

### 响应式断点
```css
/* 移动端 */
@media (max-width: 768px)

/* 小屏幕手机 */
@media (max-width: 480px) 

/* 平板设备 */
@media (min-width: 769px) and (max-width: 1024px)

/* 横屏模式 */
@media (max-width: 768px) and (orientation: landscape)
```

### 移动端优化
- 汉堡菜单导航
- 触摸友好的交互设计
- 适配不同屏幕尺寸
- 优化移动端性能

## 🔮 扩展性设计

### 模块化架构
- 组合式函数可复用
- 服务层独立封装
- 组件高度解耦

### 插件化支持
- 图表类型可扩展
- 智能体可配置
- 主题可定制

### 国际化准备
- Element Plus 内置国际化
- 统一的文本管理
- 多语言切换支持

---

这个架构设计确保了项目的可维护性、可扩展性和高性能，为工业设备监控提供了可靠的前端技术支撑。
