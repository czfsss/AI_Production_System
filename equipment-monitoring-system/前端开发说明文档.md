# 智能设备监控系统 - 前端开发说明文档

## 📚 目录
1. [环境准备](#环境准备)
2. [项目启动](#项目启动)
3. [核心概念](#核心概念)
4. [开发指南](#开发指南)
5. [常见问题](#常见问题)
6. [部署指南](#部署指南)

## 🌟 环境准备

### 必需软件安装

#### 1. Node.js (必须)
- **版本要求**: Node.js 20.19.0 或 22.12.0+
- **下载地址**: https://nodejs.org/
- **验证安装**: 
  ```bash
  node --version  # 应显示 v20.19.0 或更高版本
  npm --version   # 应显示 npm 版本
  ```

#### 2. 包管理器 (推荐 pnpm)
```bash
# 安装 pnpm (推荐)
npm install -g pnpm

# 验证安装
pnpm --version
```

#### 3. 代码编辑器 (推荐)
- **VS Code**: https://code.visualstudio.com/
- **推荐插件**:
  - Vue Language Features (Volar)
  - TypeScript Vue Plugin (Volar)
  - ESLint
  - Prettier
  - Auto Rename Tag

## 🚀 项目启动

### 第一次运行项目

```bash
# 1. 进入前端项目目录
cd equipment-monitoring-system

# 2. 安装依赖 (首次运行必须)
pnpm install
# 或使用 npm
npm install

# 3. 启动开发服务器
pnpm dev
# 或使用 npm
npm run dev
```

### 成功启动后
- 浏览器会自动打开: http://127.0.0.1:1133
- 控制台会显示: `Local: http://127.0.0.1:1133/`

### 常用开发命令

```bash
# 启动开发服务器 (热重载)
pnpm dev

# 构建生产版本
pnpm build

# 预览生产构建
pnpm preview

# 运行测试
pnpm test:unit

# 代码格式化
pnpm format

# 代码检查和修复
pnpm lint
```

## 🎯 核心概念

### 1. Vue 3 基础

#### 组件结构 (每个 .vue 文件)
```vue
<script setup lang="ts">
// JavaScript/TypeScript 逻辑代码
import { ref, onMounted } from 'vue'

// 响应式数据
const count = ref(0)

// 生命周期钩子
onMounted(() => {
  console.log('组件已挂载')
})
</script>

<template>
  <!-- HTML 模板 -->
  <div>
    <h1>计数: {{ count }}</h1>
    <button @click="count++">增加</button>
  </div>
</template>

<style scoped>
/* CSS 样式 (scoped 表示只在当前组件生效) */
h1 {
  color: blue;
}
</style>
```

#### 响应式数据
```typescript
import { ref, reactive } from 'vue'

// 基础类型使用 ref
const message = ref('Hello')
const count = ref(0)

// 对象类型使用 reactive
const user = reactive({
  name: '张三',
  age: 25
})

// 修改数据
message.value = 'Hello World'  // ref 需要 .value
count.value++
user.name = '李四'  // reactive 直接修改
```

### 2. TypeScript 基础

#### 类型定义
```typescript
// 接口定义
interface User {
  id: number
  name: string
  email?: string  // 可选属性
}

// 函数类型
const handleClick = (id: number): void => {
  console.log('点击了', id)
}

// 数组类型
const numbers: number[] = [1, 2, 3]
const users: User[] = []
```

### 3. Pinia 状态管理

#### 创建 Store
```typescript
// stores/example.ts
import { ref, computed } from 'vue'
import { defineStore } from 'pinia'

export const useExampleStore = defineStore('example', () => {
  // 状态
  const count = ref(0)
  
  // 计算属性
  const doubleCount = computed(() => count.value * 2)
  
  // 方法
  const increment = () => {
    count.value++
  }
  
  return { count, doubleCount, increment }
})
```

#### 使用 Store
```vue
<script setup lang="ts">
import { useExampleStore } from '@/stores/example'

const store = useExampleStore()

// 使用状态
console.log(store.count)

// 调用方法
store.increment()
</script>
```

## 📖 开发指南

### 1. 添加新页面

#### 步骤 1: 创建页面组件
```vue
<!-- src/views/NewPageView.vue -->
<script setup lang="ts">
import { ref } from 'vue'

const title = ref('新页面')
</script>

<template>
  <div class="new-page">
    <h1>{{ title }}</h1>
    <p>这是一个新页面</p>
  </div>
</template>

<style scoped>
.new-page {
  padding: 20px;
}
</style>
```

#### 步骤 2: 添加路由
```typescript
// src/router/index.ts
const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes: [
    // ... 现有路由
    {
      path: '/newpage',
      name: 'newpage',
      component: () => import('../views/NewPageView.vue')
    }
  ]
})
```

#### 步骤 3: 添加导航 (可选)
```vue
<!-- src/App.vue -->
<template>
  <!-- 在 modules 数组中添加 -->
  <script setup lang="ts">
  const modules = [
    { key: 'monitoring', name: '设备监控', icon: 'Monitor' },
    { key: 'maintenance', name: '辅助维修', icon: 'Tools' },
    { key: 'knowledge', name: '智能问答', icon: 'Reading' },
    { key: 'newpage', name: '新页面', icon: 'DocumentAdd' }  // 新添加
  ]
  </script>
</template>
```

### 2. 创建新组件

#### 通用组件
```vue
<!-- src/components/MyComponent.vue -->
<script setup lang="ts">
// 定义 props (父组件传入的数据)
interface Props {
  title: string
  count?: number  // 可选
}

const props = withDefaults(defineProps<Props>(), {
  count: 0  // 默认值
})

// 定义 emits (向父组件发送事件)
const emit = defineEmits<{
  click: [id: number]  // 事件名: [参数类型]
}>()

const handleClick = () => {
  emit('click', 123)
}
</script>

<template>
  <div class="my-component">
    <h2>{{ title }}</h2>
    <p>计数: {{ count }}</p>
    <button @click="handleClick">点击我</button>
  </div>
</template>
```

#### 使用组件
```vue
<script setup lang="ts">
import MyComponent from '@/components/MyComponent.vue'

const handleComponentClick = (id: number) => {
  console.log('组件点击了', id)
}
</script>

<template>
  <MyComponent 
    title="我的标题" 
    :count="100" 
    @click="handleComponentClick"
  />
</template>
```

### 3. 调用后端 API

#### 创建 API 服务
```typescript
// src/services/myService.ts
import axios from 'axios'
import { API_CONFIG } from '@/config/api'

interface MyData {
  id: number
  name: string
}

export async function getMyData(): Promise<MyData[]> {
  try {
    const response = await axios.get(`${API_CONFIG.baseURL}/api/my-data`)
    return response.data
  } catch (error) {
    console.error('获取数据失败:', error)
    throw new Error('获取数据失败')
  }
}

export async function postMyData(data: Partial<MyData>): Promise<MyData> {
  try {
    const response = await axios.post(`${API_CONFIG.baseURL}/api/my-data`, data)
    return response.data
  } catch (error) {
    console.error('提交数据失败:', error)
    throw new Error('提交数据失败')
  }
}
```

#### 在组件中使用
```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { getMyData, postMyData } from '@/services/myService'
import { ElMessage } from 'element-plus'

const dataList = ref<MyData[]>([])
const loading = ref(false)

// 获取数据
const fetchData = async () => {
  loading.value = true
  try {
    dataList.value = await getMyData()
    ElMessage.success('获取数据成功')
  } catch (error) {
    ElMessage.error('获取数据失败')
  } finally {
    loading.value = false
  }
}

// 提交数据
const submitData = async () => {
  try {
    await postMyData({ name: '新数据' })
    ElMessage.success('提交成功')
    fetchData() // 重新获取数据
  } catch (error) {
    ElMessage.error('提交失败')
  }
}

// 组件挂载时获取数据
onMounted(() => {
  fetchData()
})
</script>

<template>
  <div>
    <el-button @click="fetchData" :loading="loading">
      刷新数据
    </el-button>
    <el-button @click="submitData">
      提交数据
    </el-button>
    
    <el-table :data="dataList" v-loading="loading">
      <el-table-column prop="id" label="ID" />
      <el-table-column prop="name" label="名称" />
    </el-table>
  </div>
</template>
```

### 4. 使用 Element Plus 组件

#### 常用组件示例
```vue
<template>
  <!-- 按钮 -->
  <el-button type="primary" @click="handleClick">主要按钮</el-button>
  <el-button type="success">成功按钮</el-button>
  
  <!-- 表单 -->
  <el-form :model="form" :rules="rules" ref="formRef">
    <el-form-item label="用户名" prop="username">
      <el-input v-model="form.username" />
    </el-form-item>
    <el-form-item label="密码" prop="password">
      <el-input v-model="form.password" type="password" />
    </el-form-item>
    <el-form-item>
      <el-button type="primary" @click="submitForm">提交</el-button>
    </el-form-item>
  </el-form>
  
  <!-- 表格 -->
  <el-table :data="tableData">
    <el-table-column prop="name" label="姓名" />
    <el-table-column prop="age" label="年龄" />
  </el-table>
  
  <!-- 对话框 -->
  <el-dialog v-model="dialogVisible" title="提示">
    <p>对话框内容</p>
    <template #footer>
      <el-button @click="dialogVisible = false">取消</el-button>
      <el-button type="primary" @click="dialogVisible = false">确定</el-button>
    </template>
  </el-dialog>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue'
import { ElMessage } from 'element-plus'

// 表单数据
const form = reactive({
  username: '',
  password: ''
})

// 表单验证规则
const rules = {
  username: [
    { required: true, message: '请输入用户名', trigger: 'blur' }
  ],
  password: [
    { required: true, message: '请输入密码', trigger: 'blur' },
    { min: 6, message: '密码至少6位', trigger: 'blur' }
  ]
}

const formRef = ref()
const dialogVisible = ref(false)
const tableData = ref([
  { name: '张三', age: 25 },
  { name: '李四', age: 30 }
])

const submitForm = async () => {
  try {
    await formRef.value.validate()
    // 验证通过，提交表单
    ElMessage.success('提交成功')
  } catch (error) {
    ElMessage.error('请检查表单')
  }
}
</script>
```

### 5. WebSocket 实时数据

#### 使用现有的 WebSocket 服务
```vue
<script setup lang="ts">
import { ref, onMounted, onUnmounted } from 'vue'
import { createWebSocketService } from '@/services/websocket'

const wsService = createWebSocketService()
const realTimeData = ref({})
const isConnected = ref(false)

// 连接 WebSocket
const connectWebSocket = async () => {
  try {
    await wsService.connect('设备名称')
    isConnected.value = true
    
    // 监听消息
    wsService.on('message', (data) => {
      realTimeData.value = data
      console.log('收到实时数据:', data)
    })
    
    // 监听连接状态
    wsService.on('connected', () => {
      console.log('WebSocket 已连接')
      isConnected.value = true
    })
    
    wsService.on('disconnected', () => {
      console.log('WebSocket 已断开')
      isConnected.value = false
    })
    
  } catch (error) {
    console.error('WebSocket 连接失败:', error)
  }
}

// 组件挂载时连接
onMounted(() => {
  connectWebSocket()
})

// 组件卸载时断开连接
onUnmounted(() => {
  wsService.disconnect()
})
</script>

<template>
  <div>
    <el-tag :type="isConnected ? 'success' : 'danger'">
      {{ isConnected ? '已连接' : '未连接' }}
    </el-tag>
    
    <pre>{{ JSON.stringify(realTimeData, null, 2) }}</pre>
  </div>
</template>
```

## ❓ 常见问题

### 1. 开发环境问题

#### Q: 启动项目时报错 "command not found: pnpm"
**A**: 需要先安装 pnpm
```bash
npm install -g pnpm
```

#### Q: npm install 速度很慢
**A**: 使用国内镜像源
```bash
# 设置 npm 镜像
npm config set registry https://registry.npmmirror.com/

# 或使用 pnpm
pnpm config set registry https://registry.npmmirror.com/
```

#### Q: 页面更新了但浏览器没有刷新
**A**: 确保开发服务器正在运行，检查控制台是否有错误

### 2. 代码问题

#### Q: TypeScript 报错 "Property 'xxx' does not exist"
**A**: 检查类型定义，确保导入了正确的类型
```typescript
// 错误示例
const user = {} // TypeScript 不知道 user 的类型
user.name = '张三' // 报错

// 正确示例
interface User {
  name: string
}
const user: User = { name: '张三' } // 或
const user = { name: '张三' } as User
```

#### Q: 样式不生效
**A**: 检查以下几点：
1. CSS 选择器是否正确
2. 是否有其他样式覆盖
3. 是否使用了 `scoped` 属性
4. Element Plus 组件可能需要使用 `:deep()` 深度选择器

```vue
<style scoped>
/* 修改 Element Plus 组件样式 */
:deep(.el-button) {
  border-radius: 10px;
}
</style>
```

### 3. API 调用问题

#### Q: API 请求失败，出现 CORS 错误
**A**: 检查后端是否配置了 CORS，或在开发环境配置代理
```typescript
// vite.config.ts
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true
      }
    }
  }
})
```

#### Q: 请求超时
**A**: 检查网络连接和后端服务状态，可以设置更长的超时时间
```typescript
import axios from 'axios'

const api = axios.create({
  timeout: 10000 // 10秒超时
})
```

## 📦 部署指南

### 1. 构建生产版本

```bash
# 构建项目
pnpm build

# 构建完成后，会在 dist 目录生成静态文件
```

### 2. 环境变量配置

创建环境变量文件：
```bash
# .env.development (开发环境)
VITE_API_BASE_URL=http://127.0.0.1:8000

# .env.production (生产环境) 
VITE_API_BASE_URL=http://10.43.32.231:8000
```

### 3. 部署到服务器

#### 使用 Nginx
```nginx
# nginx.conf
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        root /path/to/dist;
        index index.html;
        try_files $uri $uri/ /index.html;
    }
    
    # API 代理
    location /api {
        proxy_pass http://backend-server:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

#### 使用项目提供的部署脚本
```bash
# 使用项目根目录的 deploy.ps1 脚本
./deploy.ps1
```

### 4. 健康检查

部署后检查以下项目：
1. 页面能否正常打开
2. API 接口是否正常
3. WebSocket 连接是否成功
4. 控制台是否有错误信息

## 📚 学习资源

### 官方文档
- [Vue 3 官方文档](https://cn.vuejs.org/)
- [Element Plus 组件库](https://element-plus.org/zh-CN/)
- [TypeScript 手册](https://www.typescriptlang.org/zh/docs/)
- [Pinia 状态管理](https://pinia.vuejs.org/zh/)
- [ECharts 图表库](https://echarts.apache.org/zh/index.html)

### 推荐教程
- Vue 3 + TypeScript 入门教程
- Element Plus 组件使用指南
- 前端开发最佳实践

### 开发工具
- [Vue DevTools](https://devtools.vuejs.org/) - Vue 开发者工具
- [ESLint](https://eslint.org/) - 代码质量检查
- [Prettier](https://prettier.io/) - 代码格式化

---

这份文档涵盖了前端开发的基础知识和实际操作指南。如果遇到具体问题，建议：
1. 先查看控制台错误信息
2. 查阅相关的官方文档
3. 搜索类似问题的解决方案
4. 适当询问有经验的开发者

记住：前端开发是一个逐步学习的过程，不要急于求成，多动手实践才能掌握！
